<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Suspense Bangla</title>
<link rel="icon" type="image/png" href="Suspense Bangla logo design.png">

<style>
:root{
  --red:#ff0000;
  --green:#008000;
  --primary:#ff3b5c;
  --dark:#121212;
  --light:#ffffff;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui;}

body{
  background:var(--dark);
  color:white;
  overflow:hidden;
}

/* APP CONTAINER */

/* Hide scrollbar for Chrome, Safari and Opera */
.list-container::-webkit-scrollbar {
  display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.list-container {
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}
.app{
  width:100%;
  max-width:500px;
  height:100vh;
  margin:auto;
  background:#111;
  position:relative;
  overflow:hidden;
  display: flex;
  flex-direction: column;
}

/* HEADER & BRANDING */
.header-area {
  padding: 20px 20px 5px;
  text-align: center;
}

.logo-img {
  height: 60px;
  margin-bottom: 5px;
  object-fit: contain;
}

.brand{
  font-size:32px;
  font-weight:900;
  letter-spacing:1px;
}
.brand span:first-child{color:var(--red)}
.brand span:last-child{color:var(--green)}

/* SEARCH */
.search{
  padding:10px 20px 15px;
}
.search input{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:1px solid #333;
  background:#222;
  color:white;
  outline: none;
}
.search input:focus { border-color: var(--red); }

/* LIST */
.list-container {
  flex: 1;
  overflow-y: auto;
  padding-bottom: 20px;
}

.item{
  display:flex;
  align-items:center;
  padding:12px 20px;
  cursor:pointer;
  transition:.3s;
}
.item:hover{background:#1a1a1a;}

.item img{
  width:55px;
  height:55px;
  border-radius:10px;
  object-fit:cover;
  margin-right:15px;
}

.item-title{
  font-size:14px;
  font-weight:500;
  line-height:1.4;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* LOAD MORE */
.load-more-btn {
  display: none;
  width: calc(100% - 40px);
  margin: 15px 20px;
  padding: 12px;
  background: transparent;
  color: white;
  border: 1px solid #444;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
}

/* PLAYER OVERLAY */
.now-playing{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:black;
  transform:translateY(100%);
  transition:.5s ease;
  display:flex;
  flex-direction:column;
  z-index: 100;
}
.now-playing.active{ transform:translateY(0); }

.bg{
  position:absolute;
  width:100%;
  height:100%;
  background-size:cover;
  background-position:center;
  filter:blur(30px);
  opacity:.4;
}

.top-bar{ padding:20px; z-index:2; }
.back{ font-size:18px; cursor:pointer; }

.cover{ margin-top:20px; text-align:center; z-index:2; }
.cover img{ width:70%; border-radius:20px; }

.player-card{
  margin-top:auto;
  background:white;
  border-radius:30px 30px 0 0;
  padding:25px;
  color:black;
  z-index:2;
}

.song-title{ text-align:center; font-weight:bold; margin-bottom:15px; }

.controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:30px;
  margin:20px 0;
}
.controls button { background:none; border:none; font-size:24px; cursor:pointer; color:black; }

.play-btn{
  width:70px;
  height:70px;
  border-radius:50%;
  border:none;
  background:var(--red);
  color:white;
  font-size:22px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

.progress{
  height:5px;
  background:#ddd;
  border-radius:10px;
  margin:10px 0;
  position:relative;
  cursor:pointer;
}
.progress-bar{ height:100%; width:0%; background:var(--red); border-radius:10px; }

.time{ display:flex; justify-content:space-between; font-size:12px; color:#555; }

#yt-api-player { position:absolute; top:-9999px; }
</style>
</head>
<body>

<div class="app">
  <div class="header-area">
    <img src="Suspense Bangla logo design.png" class="logo-img" alt="Logo">
    <div class="brand">
      <span>Suspense</span> <span>Bangla</span>
    </div>
  </div>

  <div class="search">
    <input type="text" id="search" placeholder="Search story...">
  </div>

  <div class="list-container">
    <div id="stories"></div>
    <button id="loadMore" class="load-more-btn">Load More Stories</button>
  </div>

  <div class="now-playing" id="nowPlaying">
    <div class="bg" id="playerBg"></div>
    <div class="top-bar"><div class="back" onclick="closePlayer()">← Back</div></div>
    <div class="cover"><img id="playerImg"></div>
    <div class="player-card">
      <div class="song-title" id="playerTitle"></div>
      <div class="controls">
        <button onclick="prevStory()">⏮</button>
        <button class="play-btn" id="playPause">▶</button>
        <button onclick="nextStory()">⏭</button>
      </div>
      <div id="progress" class="progress">
        <div id="progressBar" class="progress-bar"></div>
      </div>
      <div class="time">
        <span id="audioTime">00:00 / 00:00</span>
      </div>
    </div>
  </div>
</div>

<div id="yt-api-player"></div>

<script>
const JSON_URL = "https://raw.githubusercontent.com/Spin1234/suspense-data/main/stories.json";

let allStories=[];
let filteredStories=[];
let visibleCount=25;
let ytPlayer=null;
let progressInterval=null;
let currentIdx = 0;

/* Load YouTube API */
const tag=document.createElement('script');
tag.src="https://www.youtube.com/iframe_api";
document.head.appendChild(tag);

window.onYouTubeIframeAPIReady=()=>{
  ytPlayer=new YT.Player('yt-api-player',{
    height:'200',width:'200',
    playerVars:{autoplay:0,controls:0,playsinline:1},
    events:{onStateChange:onPlayerStateChange}
  });
};

async function fetchStories(){
  try{
    const res=await fetch(JSON_URL);
    const data=await res.json();
    allStories=data
      .filter(item=>item.title)
      .sort((a,b)=>new Date(b.publishedAt)-new Date(a.publishedAt));
    filteredStories = [...allStories];
    renderStories();
  }catch(err){ console.error("JSON Load Error:",err); }
}

/* RESTORED SEARCH LOGIC */
function renderStories(){
  const container=document.getElementById("stories");
  const loadBtn=document.getElementById("loadMore");

  const rawQuery=document.getElementById("search").value.trim().toLowerCase();
  const keywords=rawQuery.split(" ").filter(k=>k.length>0);

  // Exact Logic Requested: Multi-word Title Search
  filteredStories = allStories.filter(story=>{
    if(keywords.length===0) return true;
    const title=story.title.toLowerCase();
    return keywords.every(word=>title.includes(word));
  });

  container.innerHTML="";
  filteredStories.slice(0,visibleCount).forEach((story, index)=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <img src="${story.thumbnail}">
      <div class="item-title">${story.title}</div>
    `;
    div.onclick=()=>playStory(index);
    container.appendChild(div);
  });

  loadBtn.style.display=visibleCount<filteredStories.length?"block":"none";
}

function playStory(index){
  currentIdx = index;
  const story = filteredStories[index];
  document.getElementById("nowPlaying").classList.add("active");
  document.getElementById("playerImg").src=story.thumbnail;
  document.getElementById("playerBg").style.backgroundImage=`url(${story.thumbnail})`;
  document.getElementById("playerTitle").textContent=story.title;
  ytPlayer.loadVideoById(story.videoId);
  ytPlayer.playVideo();
}

function closePlayer(){
  document.getElementById("nowPlaying").classList.remove("active");
}

function onPlayerStateChange(event){
  const btn=document.getElementById("playPause");
  if(event.data===YT.PlayerState.PLAYING){
    btn.textContent="❚❚";
    startProgress();
  } else {
    btn.textContent="▶";
    stopProgress();
  }
}

function formatTime(seconds){
  const mins=Math.floor(seconds/60);
  const secs=Math.floor(seconds%60);
  return `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
}

function startProgress(){
  if(progressInterval) clearInterval(progressInterval);
  progressInterval=setInterval(()=>{
    const current=ytPlayer.getCurrentTime();
    const duration=ytPlayer.getDuration();
    if(duration){
      const percent=(current/duration)*100;
      document.getElementById("progressBar").style.width=percent+"%";
      document.getElementById("audioTime").textContent= `${formatTime(current)} / ${formatTime(duration)}`;
    }
  },500);
}

function stopProgress(){ clearInterval(progressInterval); }

document.getElementById("progress").onclick=(e)=>{
  const width=e.currentTarget.clientWidth;
  const clickX=e.offsetX;
  const duration=ytPlayer.getDuration();
  ytPlayer.seekTo((clickX/width)*duration,true);
};

document.getElementById("playPause").onclick=()=>{
  const state=ytPlayer.getPlayerState();
  if(state===YT.PlayerState.PLAYING) ytPlayer.pauseVideo();
  else ytPlayer.playVideo();
};

document.getElementById("search").oninput=()=>{
  visibleCount=25;
  renderStories();
};

document.getElementById("loadMore").onclick=()=>{
  visibleCount+=25;
  renderStories();
};

function prevStory(){ if(currentIdx > 0) playStory(currentIdx - 1); }
function nextStory(){ if(currentIdx < filteredStories.length - 1) playStory(currentIdx + 1); }

fetchStories();
</script>

</body>
</html>